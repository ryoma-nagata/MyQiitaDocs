---
title: Azure Synapse Analytics (旧 Azure SQL Data Warehouse)の可用性について
tags:
  - Microsoft
  - SQLServer
  - Azure
  - DataWarehouse
private: false
updated_at: '2019-11-28T14:16:00+09:00'
id: 624a5e95c26f50b54b2a
organization_url_name: null
slide: false
---
#はじめに
Azure Synapse Analytics（以下、SQL DW）における可用性について調査結果をメモします。
※調査を実施した2019/10月時点の情報です。


##SLA
https://azure.microsoft.com/ja-jp/support/legal/sla/synapse-analytics/v1_0/
99.9%となっています。
情報分析においては高可用性は不要でしょうから、十分なレベルでしょう。


#障害対応の方針
では本題ですが、結論からいうとSQL DWは「データセンター内での冗長化」のみをサポートしているという調査結果となりました。
SQL DatabaseのPremium および Business Criticalサービスレベルの様にゾーン冗長構成をとり高可用性構成はとれないということです。

##フェールオーバー
上記の冗長性オプションを踏まえて、フェールオーバーのパターンは下記2つに整理できます。
 1. データセンターの一部に障害が発生した場合
 2. １つのデータセンター全体に障害が発生した場合

##1. データセンターの一部に障害


| フェールオーバーの実施者 |  想定ダウンタイム目安  |
| --------------------    | ------------------ |
| Azure       | 平均 数秒から数十秒     最大１分 |


データセンター内では冗長化されているため、たとえばデータセンター内のあるラックで障害が起きた場合にはAzure側で自動でフェールオーバーされます。
その際のダウンタイムは最大でも1分未満、平均数秒から数十秒を想定しているようです。



##2. １つのデータセンターの全部に障害
| フェールオーバーの実施者 |  想定ダウンタイム目安  |
| --------------------    | ------------------ |
| サービス利用側の開発者    | 開発時の設定による |

SQL DWはたとえば東日本と西日本のように地域を跨いだレプリケーションを構成できない為、地域を跨いだフェールオーバーは実施できません。

したがって、単一のデータセンター全体での障害発生時についてはユーザ側での対応が必要で、
下記リンクのようにGeoリストアを用いて、別のデータセンターに手動復元することがフェールオーバの対応となります。
[Azure SQL Data Warehouse の geo 復元参考リンク](https://docs.microsoft.com/ja-jp/azure/sql-data-warehouse/sql-data-warehouse-restore-from-geo-backup)

###Geoリストア
SQL DWでは自動バックアップ機能が既定で有効となっており、自動バックアップで取得されたバックアップデータをペアとなるデータセンター（東日本なら西日本）に24時間に1回の間隔でコピーしています。
このデータを利用して復元することをGeoリストアといいます。

#以上
備忘録的なメモとして記載しました。
ご参考まで。


